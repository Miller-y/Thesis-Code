t = [-27.56,0,20]';
t_c1_c2 = [-41.5, 24.3235,-0.6165]';
t_c1_c3 = [-41.5, -24.3235,-0.9340]';
Rc1c2 = eul2rotm([2.0975 0.0025    0.0026 ]);
Rc1c3 = eul2rotm([-2.1011 0.0037   -0.0046]);
tc2 = Rc1c2'*(t - t_c1_c2);
tc3 = Rc1c3'*(t - t_c1_c3);
rv = rotm2axang(Rc1c2');
rv = rv(1:3)*rv(4);
rv = rotm2axang(Rc1c3');
rv = rv(1:3)*rv(4);

uf = [];
u = 3648/2 + 22.9962;
f = 41.16/(7e-3) + 6.6583;
uf(end+1,:) = [u f];
u = 3648/2 -21.2692;
f = 41.16/(7e-3)-4.8712;
uf(end+1,:) = [u f];
u = 3648/2 + 48.5539;
f = 41.16/(7e-3)-2.2692;
uf(end+1,:) = [u f];


v1 = [0.993223   -0.104445    0.0523325];
v2 = [0.104334    0.992123   -0.0698147];
R = [0.999609634897246,-0.0276646118014284,0.00390475024432321;
    -0.0275112223359308,-0.999008321555634,-0.0350072293702102;
    0.00486933939844570,0.0348861393173821,-0.999379430855644];
R_err = [0.9996   -0.0277    0.0039
    -0.0275   -0.9990   -0.0350
    0.0049    0.0349   -0.9994
    ];
rv_s_x  = R_err*v1';
rv_s_y = R_err*v2';
rv_b_x = v1';
rv_b_y = v2';

V1 = cal_V(rv_s_x, rv_b_x);
V2 = cal_V(rv_s_y, rv_b_y);
V = [V1;V2];
[U,S,VV] = svd(V);
q_sb_ans = VV(:,4)';
R_sb_ans = quat2rotm(q_sb_ans)

function V = cal_V(vs, vb)
V = zeros(4);
% L = zeros(4);
x = vs(1);
y = vs(2);
z =  vs(3);
vl = [
    0 -x -y -z
    x 0  -z y
    y z 0 -x
    z -y x 0];
x = vb(1);
y = vb(2);
z =  vb(3);
vr = [
    0 -x -y -z
    x 0  z -y
    y -z 0 x
    z y -x 0];
V = vl-vr;
% V(1,2) = -vs(1)+vb(1); V(1,3) = -vs(2)+vb(2); V(1,4) = -vs(3)+vb(3);
% V(2,1) = vs(1)-vb(1); V(2,3) = -vs(3)-vb(3); V(2,4) = vs(2)+vb(2);
% V(3,1) = vs(2)-vb(2); V(3,2) = vs(3)+vb(3); V(3,4) = -vs(1)-vb(1);
% V(4,1) = vs(3)-vb(3); V(4,2) = -vs(2)-vb(2); V(4,3) = vs(1)+vb(1);
% V
end










